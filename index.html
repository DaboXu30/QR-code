<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="工业半轴区块链溯源展示平台，全程可视化追踪生产流程">
    <title>工业半轴区块链溯源展示</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 保持原有CSS不变，只添加以下优化样式 */
        
        /* 图片加载优化 */
        .step-image {
            position: relative;
            min-height: 180px;
        }
        
        .image-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f0f0f0 25%, #e0e0e0 25%, #e0e0e0 50%, #f0f0f0 50%, #f0f0f0 75%, #e0e0e0 75%, #e0e0e0);
            background-size: 40px 40px;
            animation: shimmer 1.5s infinite linear;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-size: 0.9rem;
        }
        
        @keyframes shimmer {
            0% { background-position: -40px 0; }
            100% { background-position: 40px 0; }
        }
        
        /* iPad图片优化 */
        @media only screen and (min-width: 768px) and (max-width: 1024px) {
            .step-image {
                min-height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 原有HTML结构保持不变 -->
        
        <div class="process-timeline">
            <!-- 步骤1：原材料 -->
            <div class="process-step step-1">
                <div class="step-icon"><i class="fas fa-mountain"></i></div>
                <div class="step-content">
                    <div class="step-header">
                        <h3 class="step-title">原材料采购与检验</h3>
                        <div class="step-date">2025-11-06</div>
                        <span class="status-badge">区块链已验证</span>
                    </div>
                    
                    <div class="step-body">
                        <div class="step-details">
                            <!-- 详细信息不变 -->
                        </div>
                        
                        <div class="step-image">
                            <!-- 使用picture标签提供多格式支持 -->
                            <picture>
                                <!-- 首先尝试WebP -->
                                <source srcset="Y.webp" type="image/webp">
                                <!-- 然后尝试JPG -->
                                <source srcset="Y.jpg" type="image/jpeg">
                                <!-- 最后使用img作为后备 -->
                                <img src="Y.jpg" alt="原材料采购与检验" loading="lazy" 
                                     onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"200\"><rect width=\"100%\" height=\"100%\" fill=\"%23f0f0f0\"/><text x=\"50%\" y=\"50%\" font-family=\"Arial\" font-size=\"14\" text-anchor=\"middle\" dy=\".3em\" fill=\"%23999\">图片加载失败</text></svg>';">
                            </picture>
                            <div class="image-overlay">优质合金钢材原料仓库</div>
                        </div>
                    </div>
                    <!-- 区块链信息不变 -->
                </div>
            </div>
            
            <!-- 步骤2：锻造成型 -->
            <div class="process-step step-2">
                <div class="step-icon"><i class="fas fa-fire"></i></div>
                <div class="step-content">
                    <div class="step-header">
                        <h3 class="step-title">锻造成型工艺</h3>
                        <div class="step-date">2025-11-08</div>
                        <span class="status-badge">区块链已验证</span>
                    </div>
                    
                    <div class="step-body">
                        <div class="step-details">
                            <!-- 详细信息不变 -->
                        </div>
                        
                        <div class="step-image">
                            <picture>
                                <source srcset="one.webp" type="image/webp">
                                <source srcset="one.jpg" type="image/jpeg">
                                <img src="one.jpg" alt="锻造成型工艺" loading="lazy"
                                     onerror="handleImageError(this)">
                            </picture>
                            <div class="image-overlay">3000T液压锻压机正在进行半轴锻造</div>
                        </div>
                    </div>
                    <!-- 区块链信息不变 -->
                </div>
            </div>
            
            <!-- 步骤3：精密机加工 -->
            <div class="process-step step-3">
                <div class="step-icon"><i class="fas fa-cogs"></i></div>
                <div class="step-content">
                    <div class="step-header">
                        <h3 class="step-title">精密机加工</h3>
                        <div class="step-date">2025-11-11</div>
                        <span class="status-badge">区块链已验证</span>
                    </div>
                    
                    <div class="step-body">
                        <div class="step-details">
                            <!-- 详细信息不变 -->
                        </div>
                        
                        <div class="step-image">
                            <picture>
                                <source srcset="two.webp" type="image/webp">
                                <source srcset="two.jpg" type="image/jpeg">
                                <img src="two.jpg" alt="精密机加工" loading="lazy"
                                     onerror="handleImageError(this)">
                            </picture>
                            <div class="image-overlay">五轴加工中心进行半轴精密加工</div>
                        </div>
                    </div>
                    <!-- 区块链信息不变 -->
                </div>
            </div>
            
            <!-- 步骤4：热处理 -->
            <div class="process-step step-4">
                <div class="step-icon"><i class="fas fa-temperature-high"></i></div>
                <div class="step-content">
                    <div class="step-header">
                        <h3 class="step-title">热处理强化</h3>
                        <div class="step-date">2025-11-15</div>
                        <span class="status-badge">区块链已验证</span>
                    </div>
                    
                    <div class="step-body">
                        <div class="step-details">
                            <!-- 详细信息不变 -->
                        </div>
                        
                        <div class="step-image">
                            <picture>
                                <source srcset="there.webp" type="image/webp">
                                <source srcset="there.jpg" type="image/jpeg">
                                <img src="there.jpg" alt="热处理强化" loading="lazy"
                                     onerror="handleImageError(this)">
                            </picture>
                            <div class="image-overlay">热处理车间淬火工艺后效果</div>
                        </div>
                    </div>
                    <!-- 区块链信息不变 -->
                </div>
            </div>
            
            <!-- 步骤5：成品检验 -->
            <div class="process-step step-5">
                <div class="step-icon"><i class="fas fa-truck-loading"></i></div>
                <div class="step-content">
                    <div class="step-header">
                        <h3 class="step-title">成品检验与出库</h3>
                        <div class="step-date">2025-11-18</div>
                        <span class="status-badge">区块链已验证</span>
                    </div>
                    
                    <div class="step-body">
                        <div class="step-details">
                            <!-- 详细信息不变 -->
                        </div>
                        
                        <div class="step-image">
                            <picture>
                                <source srcset="four.webp" type="image/webp">
                                <source srcset="four.jpg" type="image/jpeg">
                                <img src="four.jpg" alt="成品检验与出库" loading="lazy"
                                     onerror="handleImageError(this)">
                            </picture>
                            <div class="image-overlay">成品半轴检验合格准备发货</div>
                        </div>
                    </div>
                    <!-- 区块链信息不变 -->
                </div>
            </div>
        </div>
        
        <footer>
            <!-- 页脚不变 -->
        </footer>
    </div>
    
    <script>
        // 增强的图片处理函数
        function handleImageError(img) {
            console.log('图片加载失败:', img.src);
            
            // 如果WebP失败，尝试JPG
            if (img.src.includes('.webp')) {
                img.src = img.src.replace('.webp', '.jpg');
                return;
            }
            
            // 如果JPG也失败，显示占位符
            if (img.src.includes('.jpg')) {
                img.src = 'data:image/svg+xml;utf8,' + 
                    encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="400" height="200" viewBox="0 0 400 200">' +
                    '<rect width="400" height="200" fill="#f0f0f0"/>' +
                    '<text x="200" y="100" font-family="Arial" font-size="14" text-anchor="middle" fill="#999">图片加载失败</text>' +
                    '</svg>');
                img.alt = '图片无法加载，请检查网络连接或图片路径';
                
                // 在控制台显示错误信息，帮助调试
                console.error('图片加载失败，请检查以下图片路径是否正确：');
                console.error('1. Y.webp 或 Y.jpg');
                console.error('2. one.jpg');
                console.error('3. two.webp 或 two.jpg');
                console.error('4. there.webp 或 there.jpg');
                console.error('5. four.webp 或 four.jpg');
                console.error('请确保这些图片文件与HTML文件在同一目录下');
            }
        }
        
        // 图片预加载和缓存
        function preloadImages() {
            const imageUrls = [
                'Y.webp', 'Y.jpg',
                'one.webp', 'one.jpg',
                'two.webp', 'two.jpg',
                'there.webp', 'there.jpg',
                'four.webp', 'four.jpg'
            ];
            
            imageUrls.forEach(url => {
                const img = new Image();
                img.src = url;
                img.onerror = function() {
                    console.log('预加载失败:', url);
                };
            });
        }
        
        // 图片懒加载优化
        function setupLazyLoading() {
            const images = document.querySelectorAll('.step-image img');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        if (img.dataset.src) {
                            img.src = img.dataset.src;
                            img.removeAttribute('data-src');
                        }
                        observer.unobserve(img);
                    }
                });
            }, {
                rootMargin: '100px'
            });
            
            images.forEach(img => {
                if (img.src.includes('data:image')) {
                    return; // 跳过占位符
                }
                observer.observe(img);
            });
        }
        
        // iPad特定的图片加载优化
        function optimizeForiPad() {
            if (window.innerWidth >= 768 && window.innerWidth <= 1024) {
                // 检测iOS版本
                const isOldIOS = /OS 12_\d+ like Mac OS X/.test(navigator.userAgent);
                
                if (isOldIOS) {
                    // iOS 12.5.7可能不支持WebP，强制使用JPG
                    const webpImages = document.querySelectorAll('source[type="image/webp"]');
                    webpImages.forEach(source => {
                        source.parentElement.removeChild(source);
                    });
                    
                    // 显示调试信息
                    console.log('检测到旧版iOS，已禁用WebP格式');
                }
                
                // 添加图片加载状态指示器
                const images = document.querySelectorAll('.step-image');
                images.forEach(container => {
                    const img = container.querySelector('img');
                    if (img && !img.complete) {
                        const placeholder = document.createElement('div');
                        placeholder.className = 'image-placeholder';
                        placeholder.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 加载中...';
                        container.appendChild(placeholder);
                        
                        img.onload = function() {
                            if (placeholder.parentNode) {
                                placeholder.parentNode.removeChild(placeholder);
                            }
                        };
                        
                        img.onerror = function() {
                            if (placeholder.parentNode) {
                                placeholder.innerHTML = '<i class="fas fa-exclamation-triangle"></i> 加载失败';
                                placeholder.style.color = '#e74c3c';
                            }
                        };
                    }
                });
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('工业半轴溯源页面加载完成 - iPad图片优化版');
            
            // 原有的交互代码保持不变...
            
            // 添加图片优化功能
            preloadImages();
            setupLazyLoading();
            optimizeForiPad();
            
            // 延迟检查图片加载状态
            setTimeout(() => {
                const images = document.querySelectorAll('.step-image img');
                images.forEach(img => {
                    if (!img.complete || img.naturalHeight === 0) {
                        console.warn('图片可能未正确加载:', img.src);
                        
                        // 尝试替代方案
                        if (img.src.includes('.webp')) {
                            const jpgUrl = img.src.replace('.webp', '.jpg');
                            console.log('尝试加载JPG版本:', jpgUrl);
                            img.src = jpgUrl;
                        }
                    }
                });
            }, 2000);
        });
    </script>
</body>
</html>
